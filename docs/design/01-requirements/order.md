## 주문 요구사항 명세

### 주문 & 결제

#### 기능적 요구사항

- Happy Path
    - 사용자는 로그인 상태에서 상품을 선택하고 주문 및 결제를 진행할 수 있다.
    - 상품이 구매 가능한 상태일 경우(상품 상태, 재고)에만 주문이 가능하다.
    - 주문 생성 후 결제가 성공하면 재고/포인트가 차감되고, 결제는 성공, 주문은 완료처리 된다.
        - ***결제완료 시 재고/포인트 차감***
    - 상품은 한 번에 여러 개를 주문할 수 있다.
    - 주문 생성 시 쿠폰을 적용할 수 있다.

- Fail Cases
    - 로그인하지 않은 사용자가 주문 생성을 시도할 경우 오류를 반환한다.
    - 주문 생성 실패 시 오류를 반환한다.
    - 주문 상품 목록이 없을 경우 오류를 반환한다.
    - 하나 이상의 상품이 구매 가능한 상태가 아닐 경우(비활성 상태, 재고가 부족) 주문 요청 시 오류를 반환한다.
    - 주문 생성 후 결제가 실패하면 결제/주문은 실패처리 된다.
    - 주문 생성 후 결제가 실패하면 재고/포인트/쿠폰은 차감되지 않는다.
    - 쿠폰 정보가 유효하지 않거나 사용 불가능한 경우 쿠폰 적용 시 오류를 반환한다.

#### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 통해 검증된다.
- 주문 생성 성공 시 201 Created 상태 코드와 함께 생성된 주문 ID를 응답으로 반환한다.
- 결제 성공 시 200 OK 상태 코드와 함께 결제 정보를 반환한다.

| 케이스         | 설명                                      | HTTP 상태 코드                |
|-------------|-----------------------------------------|---------------------------|
| 미로그인        | `X-USER-ID` 헤더가 없을 때, 존재하지 않는 사용자 ID일 때 | 401 Unauthorized          |
| 비활성 상품      | 요청한 상품이 주문 가능한 상태가 아닐 때                 | 409 Conflict              |
| 재고 부족       | 요청한 상품의 재고가 부족할 때                       | 409 Conflict              |
| 주문 상품 목록 없음 | 주문 요청 시 상품 목록이 비어 있을 때                  | 400 BadRequest            |
| 주문 생성 실패    | 주문 생성 과정에서 오류가 발생했을 때                   | 500 Internal Server Error |
| 결제 실패       | 결제 과정에서 오류가 발생했을 때                      | 500 Internal Server Error |
| 쿠폰 정보 없음    | 쿠폰 정보가 없을 때                             | 404 Not Found             |
| 쿠폰 사용 불가    | 쿠폰이 사용 불가능한 상태일 때                       | 409 Conflict              |

### 주문 목록 조회

#### 기능적 요구사항

- Happy Path
    - 사용자는 로그인 상태에서 자신의 주문 목록을 조회할 수 있다.
    - 주문 목록을 정렬 조건에 따라 정렬할 수 있다.
    - 주문 목록은 페이지 단위로 조회할 수 있다.

- Fail Cases
    - 로그인하지 않은 사용자가 주문 목록 조회를 시도할 경우 오류를 반환한다.
    - 잘못된 정렬 조건이 주어졌을 때 오류를 반환한다.
    - 잘못된 페이징 조건이 주어졌을 때 오류를 반환한다.

#### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 통해 검증된다.
- 주문 목록 조회 성공 시 200 OK 상태 코드와 함께 주문 목록을 반환한다.

| 케이스        | 설명                                      | HTTP 상태 코드       |
|------------|-----------------------------------------|------------------|
| 미로그인       | `X-USER-ID` 헤더가 없을 때, 존재하지 않는 사용자 ID일 때 | 401 Unauthorized |
| 잘못된 페이징 조건 | 페이지 번호나 크기가 유효하지 않은 경우                  | 400 BadRequest   |
| 잘못된 정렬 조건  | 정렬 기준이 유효하지 않은 경우                       | 400 BadRequest   |

### 주문 상세 조회

#### 기능적 요구사항

- Happy Path
    - 사용자는 로그인 상태에서 자신의 주문 상세 정보를 조회할 수 있다.
    - 주문 ID로 주문 상세 정보를 조회할 수 있다。

- Fail Cases
    - 로그인하지 않은 사용자가 주문 상세 조회를 시도할 경우 오류를 반환한다。
    - 존재하지 않는 주문 ID로 요청 시 오류를 반환한다。

#### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` 헤더를 통해 검증된다。
- 주문 상세 조회 성공 시 200 OK 상태 코드와 함께 주문 정보를 반환한다。

| 케이스        | 설명                                      | HTTP 상태 코드       |
|------------|-----------------------------------------|------------------|
| 미로그인       | `X-USER-ID` 헤더가 없을 때, 존재하지 않는 사용자 ID일 때 | 401 Unauthorized |
| 존재하지 않는 주문 | 요청한 주문 ID가 존재하지 않을 때                    | 404 Not Found    |
